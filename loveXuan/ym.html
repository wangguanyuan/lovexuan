<!DOCTYPE html>
<html lang="en">
    <head>
        <title>惹不起的大姨妈</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,600&amp;subset=latin-ext" rel="stylesheet">

        <!-- CSS -->
        <link href="assets/css/jquery.mb.YTPlayer.min.css" rel="stylesheet">
        <link href="assets/css/jquery.mb.vimeo_player.min.css" rel="stylesheet">
        <link href="assets/css/main.css" rel="stylesheet">

        <!-- JS -->
        <script src="assets/js/vendor/modernizr-2.8.3.min.js"></script>
        <script src="assets/js/vendor/jquery-1.12.0.min.js"></script>
    </head>
    <body>
        <div class="site" id="page">

            <section class="hero-section hero-section--image clearfix rotate">
                <div class="hero-section__wrap">
                        <div class="hero-section__option">
                                <img src="assets/images/ym.jpg" width="1920px" height="1080px"/>
                        </div>

                    <div class="container" style="background: rgba(255, 255, 255, 0.8);">
                        <div class="row">
                            <!-- <div class="offset-lg-2 col-lg-8">
                                <div class="title-01 title-01--11 text-center">
                                    <h2 class="title__heading">We are AweSome!</h2>
                                    <div class="title__description">Delivering extraordinary creations from the very beginning of the time!</div>

                                    <div class="title__action"><a href="#" class="btn btn-success">Get the template</a></div>
                                </div>
                            </div> -->

                            <div style="width:100%; margin: 0 auto;">
                                    <div class="chartjs-size-monitor"
                                        style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                                        <div class="chartjs-size-monitor-expand"
                                            style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                            <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                                        </div>
                                        <div class="chartjs-size-monitor-shrink"
                                            style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                            <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                                        </div>
                                    </div>
                                    <canvas id="canvas" width="1428" height="714" class="chartjs-render-monitor"
                                        style="display: block; width: 1428px; height: 714px;"></canvas>
                                </div>
                        </div>
                    </div>
                    
                </div>
                <!-- .hero-section__wrap -->
            </section>
            <!-- .hero-section -->
        </div>
        <div class="button-group">
                <a href="hope.html" class="btn btn-outline-success button-sm">心愿</a>
            <a href="index.html" class="btn btn-outline-success button-sm">想对你说</a>
            <a href="ym.html" class="btn btn-outline-success button-sm">惹不起的大姨妈</a>
        </div>

        <!-- JS -->
        <script src="assets/js/plugins/jquery.mb.YTPlayer.min.js"></script>
        <script src="assets/js/plugins/jquery.mb.vimeo_player.min.js"></script>
        <script src="assets/js/plugins/animate-headline.js"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.js"></script>
       
    </body>
</html>
<script>


        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64, 0.5)',
            yellow: 'rgb(255, 205, 86, 0.5)',
            green: 'rgb(75, 192, 192, 0.5)',
            blue: 'rgb(54, 162, 235, 0.5)',
            purple: 'rgb(153, 102, 255, 0.8)',
            grey: 'rgb(201, 203, 207, 0.5)'
        };


		// 对Date的扩展，将 Date 转化为指定格式的String   
		// 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，   
		// 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)   
		// 例子：   
		// (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423   
		// (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18   
		function dateFormat(d, fmt)   {   
			var o = {   
				"M+" : d.getMonth()+1,                 //月份   
				"d+" : d.getDate(),                    //日   
				"h+" : d.getHours(),                   //小时   
				"m+" : d.getMinutes(),                 //分   
				"s+" : d.getSeconds(),                 //秒   
				"q+" : Math.floor((d.getMonth()+3)/3), //季度   
				"S"  : d.getMilliseconds()             //毫秒   
			};   
			if(/(y+)/.test(fmt))   
				fmt=fmt.replace(RegExp.$1, (d.getFullYear()+"").substr(4 - RegExp.$1.length));   
			for(var k in o)   
				if(new RegExp("("+ k +")").test(fmt))   
			fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
			return fmt;   
		}

		var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		var datas = [
			new Date(2018, 0, 25),
			new Date(2018, 1, 22),
			new Date(2018, 2, 24),
			new Date(2018, 3, 23),
			new Date(2018, 4, 21),
			new Date(2018, 5, 18),
			new Date(2018, 6, 16),
			new Date(2018, 7, 12),
			new Date(2018, 8, 11),
			new Date(2018, 9, 12),
			new Date(2018, 10, 7),
			new Date(2018, 11, 5),
			new Date(2019, 0, 2),
			new Date(2019, 0, 30),
			new Date(2019, 1, 27),
			new Date(2019, 2, 27),
			new Date(2019, 3, 26),
			new Date(2019, 4, 24),
			new Date(2019, 5, 21),
			new Date(2019, 6, 22),
			new Date(2019, 7, 19),
			new Date(2019, 8, 19),
			new Date(2019, 9, 18),
			new Date(2019, 10, 14),
			new Date(2019, 11, 13),	
			new Date(2020, 0, 11),
			new Date(2020, 1, 9),
			new Date(2020, 2, 9),
			new Date(2020, 3, 7),
			new Date(2020, 4, 6),
			new Date(2020, 5, 4),
			new Date(2020, 6, 2),
			new Date(2020, 7, 2),
			new Date(2020, 7, 30),
			new Date(2020, 9, 1),
			new Date(2020, 10, 1),
			new Date(2020, 10, 27),
			new Date(2020, 11, 26),
			new Date(2021, 0, 24)
		];
		function gap(d1, d2) {	//计算两个日期见的间隔
			return Math.ceil((d2.getTime() - d1.getTime()) / (24 * 60 * 60 * 1000));
		}
		function fillData() {
			let data = [0];
			for (let i = 1; i < datas.length; ++i) {
				data.push(gap(datas[i - 1], datas[i]));
			}
			return data;
		}
		function sum(a) {
			let X = $.extend(true,[],a);
			let res = 0;
			for (let i = 0; i < X.length; ++i) {
				res += X[i];
			}
			return res;
		}
		function dotMuti(X, Y) {
			let res = $.extend(true,[],X);
			for (let i = 0; i < X.length; ++i) {
				res[i] *= Y[i];
			}
			return res;
		}
		function pow2(X) {
			let res = $.extend(true,[],X);
			for (let i = 0; i < X.length; ++i) {
				res[i] *= res[i];
			}
			return res;
		}
		//用最大二乘法做一元回归分析
		function predNext() {	//预测下一次
			let Y = fillData().slice(1);	//丢弃第一个y
			let X = Array.from(Y.keys());
			// console.log('X', X);
			// console.log('Y', Y);
			let n = X.length;
			let b = (n * sum(dotMuti(X, Y)) - sum(X) * sum(Y)) / (n * sum(pow2(X)) - Math.pow(sum(X), 2));
			let a = sum(Y) / n - b * sum(X) / n;
			// console.log('X', X);
			// console.log('Y', Y);
			return Math.floor(a + b * n + 0.5);
		}
		
		function fillLabels() {
			let labels = [];
			for (let i = 1; i <= datas.length; ++i) {
				labels.push(dateFormat(datas[i - 1], 'yyyy-MM-dd'));
			}
			labels.push('下次估计' + dateFormat(new Date(datas[datas.length - 1].getTime() + predNext() * 24 * 60 * 60 * 1000) , 'yyyy-MM-dd'));
			// console.log('labels', labels)
			return labels;
		}
		
		function fillData2() {
			let data = [0];
			for (let i = 1; i < datas.length; ++i) {
				data.push(gap(datas[i - 1], datas[i]));
			}
			data.push(predNext());
			return data;
		}


		
		var config = {
			type: 'line',
			data: {
				labels: fillLabels(),
				datasets: [{
					label: '可爱璇的亲戚拜访间隔',
					borderColor: window.chartColors.purple,
					backgroundColor: window.chartColors.purple,
					data:fillData2()
					
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: '专属可爱璇的神秘曲线'
				},
				tooltips: {
					mode: 'index',
				},
				hover: {
					mode: 'index'
				},
				scales: {
					xAxes: [{
						scaleLabel: {
							display: true,
                            labelString: '次序',
						}
					}],
					yAxes: [{
						stacked: true,
						scaleLabel: {
							display: true,
							labelString: '前后间隔（天）'
						}
					}]
				}
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);
		};

		// Define a plugin to provide data labels
		Chart.plugins.register({
			afterDatasetsDraw: function(chart) {
				var ctx = chart.ctx;

				chart.data.datasets.forEach(function(dataset, i) {
					var meta = chart.getDatasetMeta(i);
					if (!meta.hidden) {
						meta.data.forEach(function(element, index) {
							// Draw the text in black, with the specified font
							ctx.fillStyle = '#64210';

							var fontSize = 16;
							var fontStyle = 'normal';
							var fontFamily = 'Helvetica Neue';
							ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

							// Just naively convert to string for now
							var dataString = dataset.data[index].toString();
							// var dataString = datas[index].Format("yyyy-MM-dd");  

							// Make sure alignment settings are correct
							ctx.textAlign = 'center';
							ctx.textBaseline = 'middle';

							var padding = 5;
							var position = element.tooltipPosition();
							ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
						});
					}
				});
			}
		});
	</script>
